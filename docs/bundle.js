(e=>{"use strict";function t(e=new URLSearchParams(location.search)){return[...e.entries()].reduce(((e,[t,u])=>(e[t]=u,e)),{})}e.ENDPOINT_ESI="https://esi.evetech.net/dev",e.THOUSAND=1e3,e.MILLION=1e6,e.BILLION=1e9,e.TRILLION=1e12,e.formatNumber=function(t=0){const u=e.parseNumber(t)||"",[r,n]=u.toString().split(/[,.]+/),o=[...r].reverse().reduce(((e,t,u)=>u%3?e.concat(t):e.concat(" ",t)),[]).reverse().join("").trim(),s=n?.slice?.(0,2);return s?`${o}.${s}`:`${o}`},e.humaniseNumber=function(t=0,u){const r=Math.abs(t);if(r>=e.TRILLION)return`${e.formatNumber(t/e.TRILLION)} trillion ${u||""}`.trim();if(r>=e.BILLION)return`${e.formatNumber(t/e.BILLION)} billion ${u||""}`.trim();if(r>=e.MILLION)return`${e.formatNumber(t/e.MILLION)} million ${u||""}`.trim();if(r>=e.THOUSAND)return`${e.formatNumber(t/e.THOUSAND)} thousand ${u||""}`.trim();return`${e.formatNumber(t)} ${u||""}`.trim()},e.parseNumber=function(t){const u=t?.toString?.();if(!u)return;if(/[0-9., ]k$/i.test(u))return r()*e.THOUSAND;if(/[0-9., ]m$/i.test(u))return r()*e.MILLION;if(/[0-9., ]b$/i.test(u))return r()*e.BILLION;if(/[0-9., ]t$/i.test(u))return r()*e.TRILLION;return r();function r(){const e=u.replace(/,/g,".").replace(/[^0-9.]/g,"");return parseFloat(parseFloat(e).toFixed(2))||void 0}},e.roundTo=function(e=0,t=1){return Math.round(e/t)*t},e.roundUpTo=function(e=0,t=1){return Math.ceil(e/t)*t},window.addEventListener("DOMContentLoaded",(function(){const u={calculator:e.Calculator(t()),route:e.Route({onSubmit:function(e){const t={volume:u.calculator.getVolume(),collateral:u.calculator.getCollateral(),...e};u.calculator.prepareQuote(t),u.calculator.formatInputValues()}}),assets:e.Assets({onSubmit:function(e){const t={volume:e.volume,collateral:e.price,...u.calculator.getJumps()};u.calculator.prepareQuote(t),u.calculator.formatInputValues()}})};document.getElementById("ViewBody").replaceChildren(u.calculator.render(),u.route.render(),u.assets.render())}),{once:!0,passive:!0})})(window.R={}),(e=>{"use strict";const t=document.getElementById("templateCalculator");e.Calculator=(u={})=>{const r=document.importNode(t.content,!0).firstChild,n={inputs:[...r.querySelectorAll("input")],route:r.querySelector(".Calculator-route"),outcome:r.querySelector(".Calculator-outcome"),reward:r.querySelector(".Calculator-reward")};return r.addEventListener("submit",(e=>{e.preventDefault()})),n.inputs.forEach((t=>{t.addEventListener("focus",(()=>t.select()),{passive:!0}),t.addEventListener("keyup",(()=>o(function(e){return[...e.elements].reduce(((e,t)=>t?.name?(e[t.name]=t.value,e):e),{})}(r))),{passive:!0}),t.addEventListener("blur",(t=>function({target:t}){t.value=e.formatNumber(t.value)}(t)),{passive:!0})})),o(u),setTimeout((()=>r.volume.focus())),{formatInputValues:function(){n.inputs.forEach((t=>{t.value=e.formatNumber(t.value)}))},getCollateral:function(){return e.parseNumber(r.collateral.value)||0},getJumps:function(){return{jumps:e.parseNumber(r.jumps.value)||0,jumpsLowsec:e.parseNumber(r.jumpsLowsec.value)||0,jumpsNullsec:e.parseNumber(r.jumpsNullsec.value)||0}},getVolume:function(){return e.parseNumber(r.volume.value)||0},prepareQuote:o,render:function(){return r}};function o(t={}){const u={volume:e.parseNumber(t.volume)||0,collateral:e.parseNumber(t.collateral)||0,jumps:e.parseNumber(t.jumps)||0,jumpsLowsec:e.parseNumber(t.jumpsLowsec)||0,jumpsNullsec:e.parseNumber(t.jumpsNullsec)||0};u.jumpsLowsec+u.jumpsNullsec>u.jumps&&(u.jumps=u.jumpsLowsec+u.jumpsNullsec,t.jumps=u.jumps),Object.entries(t).forEach((([e,t])=>{r[e].value=t}));const o=function({volume:e,collateral:t,jumps:u,jumpsLowsec:r,jumpsNullsec:n}){const o={volume:e||0,collateral:t||0,jumps:u||0,jumpsLowsec:r||0,jumpsNullsec:n||0},s=function({volume:e}){return 1e5+e/Math.sqrt(e)*1e3||0}(o),c=function({volume:e,collateral:t}){return Math.sqrt(.001*e+Math.sqrt(.001*t))||0}(o),a=function({jumps:e,jumpsLowsec:t,jumpsNullsec:u}){const r=1*(e-t-u),n=2.5*t,o=4*u;return Math.sqrt(e)*((r+n+o)/e)||0}(o);return s*c*a}(u);n.outcome.dataset.expropriationLikely=Number.isFinite(o)&&o>0&&o>=u.collateral,n.reward.textContent=e.humaniseNumber(o,"ISK")}}})(window.R),(e=>{"use strict";const t=document.getElementById("templateRoute"),u=/^([a-zA-Z0-9\- ]+)$/,r=/^Current location: (.+)$/,n=/^â€¢\s+(.+)$/,o=/^\d+\.\s+(.+?)(?:\s[VIX]+?)?\s-/,s=/^\d+\.\s+(.+?)\s\(/,c=/^\d+\s+(.+?)\s+Stargate/,a=/<a href=.+>([a-zA-Z0-9\- ]+)<\/a>/,l=/EVE System > Channel changed to Local\s+:\s+([a-zA-Z0-9\- ]+)$/;e.Route=(m={})=>{const i=document.importNode(t.content,!0).firstChild,p={input:i.querySelector(".Route-input"),doSubmit:i.querySelector(".Route-doSubmit")};return i.addEventListener("submit",d),{dom:p,render:function(){return i},calculateJumps:d};function d(t){t?.preventDefault?.();const i=function(e=""){return e.split("\n").map((e=>e.trim())).reduce(((e,t)=>{const m=u.exec(t)?.[1]||c.exec(t)?.[1]||a.exec(t)?.[1]||l.exec(t)?.[1]||n.exec(t)?.[1]||o.exec(t)?.[1]||r.exec(t)?.[1]||s.exec(t)?.[1];return m&&m.length>0?e.concat(m):e}),[])}(p.input.value),{jumps:d,jumpsLowsec:N,jumpsNullsec:f}=function(t=[]){return t.reduce(((t,u)=>{const r=window.SYSTEM_DATA?.[u]?.security;if(!Number.isFinite(r))return t;t.jumps+=1;const n=e.roundTo(r,.1);return n<.1?(t.jumpsNullsec+=1,t):n<.5?(t.jumpsLowsec+=1,t):t}),{jumps:0,jumpsLowsec:0,jumpsNullsec:0})}(i);return m.onSubmit({jumps:d,jumpsLowsec:N,jumpsNullsec:f})}}})(window.R),(e=>{"use strict";const t=document.getElementById("templateAssets"),u=/^([^\t]+)/,r=/\t([^\t]*)\t/,n=/\t([^\t]+)m3\t/,o=/\t([^\t]+)ISK/;e.Assets=(s={})=>{const c=document.importNode(t.content,!0).firstChild,a={input:c.querySelector(".Assets-input"),doSubmit:c.querySelector(".Assets-doSubmit")};return c.addEventListener("submit",m),Object.freeze({render:function(){return c},calculateTotals:m});function l(t=0){return t>=e.TRILLION?e.roundUpTo(1*t,e.BILLION):t>=e.BILLION?e.roundUpTo(1.1*t,100*e.MILLION):t>=100*e.MILLION?e.roundUpTo(1.2*t,10*e.MILLION):t>=e.MILLION?e.roundUpTo(1.3*t,e.MILLION):e.roundUpTo(t,e.MILLION)}function m(t){t?.preventDefault?.();const c=function(t=""){return t.split("\n").filter((e=>!!e.trim().length)).map((t=>function(t=""){const s=t.match(u)?.[1]||"N/A",c=t.match(r)?.[1]||"1",a=t.match(n)?.[1],l=t.match(o)?.[1];return{name:s,quantity:e.parseNumber(c),volume:e.parseNumber(a),price:e.parseNumber(l)}}(t)))}(a.input.value),{quantity:m,volume:i,price:p}=function({assets:t=[]}){const u=t.reduce(((e,t)=>(e.quantity+=t.quantity||0,e.volume+=t.volume||0,e.price+=t.price||0,e)),{quantity:0,volume:0,price:0});return{quantity:e.roundUpTo(u.quantity,1),volume:e.roundUpTo(u.volume,.1),price:l(u.price)}}({assets:c});return s.onSubmit({quantity:m,volume:i,price:p})}}})(window.R,window.ITEM_DATA);
